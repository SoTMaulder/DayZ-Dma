name: Build & Release DayZ-DMA

on:
  workflow_dispatch:   # manual trigger for now

jobs:
  build:
    runs-on: windows-latest
    env:
      PAT_TOKEN: ${{ secrets.PAT_TOKEN }}

    steps:
      # 1️⃣ Checkout full repo
      - uses: actions/checkout@v4
        with:
          fetch-depth: 0

      # 2️⃣ Setup MSBuild
      - name: Setup MSBuild
        uses: microsoft/setup-msbuild@v1

      # 3️⃣ Build solution (Release x64)
      - name: Build Solution
        run: msbuild dma-dayz-cpp.sln /p:Configuration=Release

      # 4️⃣ Package EXE + mapcontent
      - name: Package Build
        shell: powershell
        run: |
          mkdir release
          Copy-Item -Path ".\x64\Release\*.exe" -Destination ".\release" -Force
          Copy-Item -Path ".\dma-dayz-cpp\mapcontent" -Destination ".\release\mapcontent" -Recurse -Force
          Compress-Archive -Path release\* -DestinationPath DayZ-DMA.zip

      # 5️⃣ Create GitHub Release (manual tag for now)
      - name: Upload to GitHub Release
        uses: softprops/action-gh-release@v2
        with:
          tag_name: v0.0.1        # We will auto-bump later
          name: "Release v0.0.1"
          files: DayZ-DMA.zip
        env:
          GITHUB_TOKEN: ${{ secrets.PAT_TOKEN }}
